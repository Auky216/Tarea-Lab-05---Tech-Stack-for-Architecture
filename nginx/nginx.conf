events {
    worker_connections 1024;
}

http {
    # Logging
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Sales Service Load Balancer
    upstream sales_backend {
        # Round Robin (default)
        server host.docker.internal:3001;
        server host.docker.internal:3011;  # segunda instancia
    }

    # Accounting Service Load Balancer
    upstream accounting_backend {
        server host.docker.internal:3002;
        server host.docker.internal:3012;  # segunda instancia
    }

    server {
        listen 80;

        # Sales endpoints
        location /api/tickets {
            proxy_pass http://sales_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/orders {
            proxy_pass http://sales_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Accounting endpoints
        location /api/report {
            proxy_pass http://accounting_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/transactions {
            proxy_pass http://accounting_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Health checks
        location /health/sales {
            proxy_pass http://sales_backend/health;
        }

        location /health/accounting {
            proxy_pass http://accounting_backend/health;
        }
    }
}